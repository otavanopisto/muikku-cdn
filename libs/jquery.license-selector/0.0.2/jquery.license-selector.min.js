/*! jquery.license-selector - v0.0.2 - 2016-04-12
* https://github.com/otavanopisto/jquery.license-selector
* Copyright (c) 2016 ; Licensed LGPL-v3 */
(function(){"use strict";var a="creativecommons.org/licenses/",b="https://creativecommons.org/publicdomain/zero/1.0/",c="http://www.wizards.com/d20/files/OGLv1.0a.rtf",d=0;$.widget("custom.licenseSelector",{options:{types:{"cc-4.0":{strategy:"cc",defaultValue:"https://creativecommons.org/licenses/by-sa/4.0",labelLocale:"createCommons40Label"},"cc-3.0":{strategy:"cc",defaultValue:"https://creativecommons.org/licenses/by-sa/3.0",labelLocale:"createCommons30Label"},"cc0-1.0":{strategy:"cc0",defaultValue:b,labelLocale:"cc0Label"},ogl:{strategy:"ogl",defaultValue:c,labelLocale:"oglLabel"},other:{strategy:"url",defaultValue:"",labelLocale:"otherLabel"}},locales:{en:{createCommons30Label:"Creative Commons 3.0",createCommons40Label:"Creative Commons 4.0",oglLabel:"Open Game License",otherLabel:"Other",createCommonsDerivatives:"Allow modifications of your work?",createCommonsDerivativesYes:"Yes",createCommonsDerivativesNo:"No",createCommonsDerivativesShareAlike:"Yes, as long as others share alike",createCommonsCommercial:"Allow commercial uses of your work?",createCommonsCommercialYes:"Yes",createCommonsCommercialNo:"No",cc0Label:"CC0 1.0 Universal"},fi:{createCommons30Label:"Creative Commons 3.0",createCommons40Label:"Creative Commons 4.0",oglLabel:"Open Game License",otherLabel:"Muu",createCommonsDerivatives:"Sallitaanko teoksen muokkaaminen?",createCommonsDerivativesYes:"Kyllä",createCommonsDerivativesNo:"Ei",createCommonsDerivativesShareAlike:"Kyllä, mikäli muut jakavat samoin ehdoin",createCommonsCommercial:"Haluatko lisenssin koskevan myös kaupallista toimintaa?",createCommonsCommercialYes:"Kyllä",createCommonsCommercialNo:"Ei",cc0Label:"CC0 1.0 Yleismaailmallinen"}}},_create:function(){this._name=this.element.attr("id")||(this.element.attr("name")||"anon")+ ++d,this.element.hide(),this._widget=$("<div>").insertBefore(this.element);$("<select>").addClass("type").appendTo(this._widget);$.each(this.options.types,$.proxy(function(a,b){this._supportsType(a)&&this._addType(a,b)},this)),this.val(this.element.val()),this._widget.on("change","select.type",$.proxy(this._onTypeSelectChange,this)),this._widget.on("change",".creative-commons-attribute",$.proxy(this._onCreativeCommonsAttributeChange,this))},val:function(a){if(void 0===a)return this.element.val();this.element.val(a),this.element.hide();var b=this._resolveType(a);switch(this._widget.find(".type-options").hide(),this._widget.find('.type-options[data-type-id="'+b+'"]').show(),this._widget.find("select.type").val(b),this._resolveStrategy(b)){case"cc":$(this._widget).find('.type-options[data-type-id="'+b+'"] *[data-default="true"]').prop("checked","checked");var c=this._parseCreativeCommons(a);$.each(c.attributes,$.proxy(function(a,c){$(this._widget).find('.type-options[data-type-id="'+b+'"] *[data-attribute="'+c+'"]').prop("checked","checked")},this));break;case"url":this.element.show()}},_onTypeSelectChange:function(a,b){var c=$(a.target).closest("select.type").val(),d=this._getTypeOptions(c);this.val(d.defaultValue)},_onCreativeCommonsAttributeChange:function(a,b){var c=$(a.target),d=this._parseCreativeCommons(this.val()),e=c.attr("data-attribute"),f=c.attr("data-remove-attributes");e&&-1==d.attributes.indexOf(e)&&d.attributes.push(e),f&&$.each(f.split(","),function(a,b){var c=d.attributes.indexOf(b);-1!=c&&d.attributes.splice(c,1)}),this.val(this._createCreativeCommonsUrl(d))},_getText:function(a){if(this.options.locale){var b=this.options.locales[this.options.locale][a];if(b)return b}return this.options.locales.en[a]},_getTypeOptions:function(a){return this.options.types[a]},_supportsType:function(a){return this._getTypeOptions(a)},_addType:function(a,b){switch(this._widget.find("select.type").append($("<option>").val(a).attr({name:"type"}).text(this._getText(b.labelLocale))),b.strategy){case"cc":$("<div>").attr({"data-type-id":a}).addClass("type-options creative-commons-container").append($("<label>").text(this._getText("createCommonsDerivatives"))).append(this._createCreativeCommonsList("creative-commons-derivatives",{yes:{label:this._getText("createCommonsDerivativesYes"),"remove-attributes":"sa,nd","default":!0},no:{label:this._getText("createCommonsDerivativesNo"),attribute:"nd","remove-attributes":"sa"},share_alike:{label:this._getText("createCommonsDerivativesShareAlike"),attribute:"sa","remove-attributes":"nd"}})).append($("<label>").text(this._getText("createCommonsCommercial"))).append(this._createCreativeCommonsList("creative-commons-commercial",{yes:{label:this._getText("createCommonsCommercialYes"),"remove-attributes":"nc","default":!0},no:{label:this._getText("createCommonsCommercialNo"),attribute:"nc"}})).hide().appendTo(this._widget);break;case"ogl":case"cc0":case"url":}},_createCreativeCommonsList:function(a,b){var c=$("<div>");return $.each(b,$.proxy(function(b,d){var e=this._name+"-"+a+"-"+b;$("<span>").append($("<input>").attr({type:"radio",name:this._name+"-"+a,value:b,id:e,"data-attribute":d.attribute,"data-remove-attributes":d["remove-attributes"],"data-default":d["default"]})).addClass("creative-commons-attribute").append($("<label>").attr({"for":e}).text(d.label)).appendTo(c)},this)),c},_resolveStrategy:function(a){if(a){var b=this._getTypeOptions(a);if(b)return b.strategy}return"url"},_resolveType:function(a){if(a){if(this._supportsType("cc0-1.0")&&a==b)return"cc0-1.0";if(this._supportsType("ogl")&&a==c)return"ogl";if(this._supportsType("cc-4.0")||this._supportsType("cc-3.0")){var d=this._parseCreativeCommons(a);if(d)if("3.0"==d.version){if(this._supportsType("cc-3.0"))return"cc-3.0"}else if(this._supportsType("cc-4.0"))return"cc-4.0"}}return"other"},_parseCreativeCommons:function(b){var c=b.replace(/^[a-z]*:\/\//,"");if(0===c.indexOf(a)){var d=c.substring(a.length).split("/");if(1==d.length)return StringUtils.equals(d[0],"publicdomain")?{attributes:["publicdomain"]}:{attributes:d[0].split("-")};if(2==d.length)return{attributes:d[0].split("-"),version:d[1]};if(3==d.length)return{attributes:d[0].split("-"),version:d[1],jurisdiction:d[2]}}return null},_createCreativeCommonsUrl:function(b){return"https://"+a+b.attributes.join("-")+"/"+(b.version?b.version:"")+(b.jurisdiction?b.jurisdiction:"")},_destroy:function(){}})}).call(this);