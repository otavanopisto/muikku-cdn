/*! jquery.license-selector - v0.0.7 - 2017-02-14
* https://github.com/otavanopisto/jquery.license-selector
* Copyright (c) 2017 ; Licensed LGPL-v3 */
(function(){"use strict";var a="creativecommons.org/licenses/",b="https://creativecommons.org/publicdomain/zero/1.0/",c="http://www.wizards.com/d20/files/OGLv1.0a.rtf",d=0;$.widget("custom.licenseSelector",{options:{types:{"cc-4.0":{strategy:"cc",defaultValue:"https://creativecommons.org/licenses/by-sa/4.0",labelLocale:"createCommons40Label"},"cc-3.0":{strategy:"cc",defaultValue:"https://creativecommons.org/licenses/by-sa/3.0",labelLocale:"createCommons30Label"},"cc0-1.0":{strategy:"cc0",defaultValue:b,labelLocale:"cc0Label"},ogl:{strategy:"ogl",defaultValue:c,labelLocale:"oglLabel"},link:{strategy:"url",defaultValue:"",labelLocale:"linkLabel",placeholderLocale:"linkPlaceholder"},text:{strategy:"text",defaultValue:"",labelLocale:"textLabel",placeholderLocale:"textPlaceholder"},none:{strategy:"none",labelLocale:"noneLabel",defaultValue:""}},locales:{en:{createCommons30Label:"Creative Commons 3.0",createCommons40Label:"Creative Commons 4.0",oglLabel:"Open Game License",linkLabel:"Link",linkPlaceholder:"License URL address",textLabel:"Text",textPlaceholder:"License text",createCommonsDerivatives:"Allow modifications of your work?",createCommonsDerivativesYes:"Yes",createCommonsDerivativesNo:"No",createCommonsDerivativesShareAlike:"Yes, as long as others share alike",createCommonsCommercial:"Allow commercial uses of your work?",createCommonsCommercialYes:"Yes",createCommonsCommercialNo:"No",cc0Label:"CC0 1.0 Universal",noneLabel:"No license"},fi:{createCommons30Label:"Creative Commons 3.0",createCommons40Label:"Creative Commons 4.0",oglLabel:"Open Game License",linkLabel:"Linkki",linkPlaceholder:"URL-osoite lisenssiin",textLabel:"Teksti",textPlaceholder:"Lisenssiteksti",createCommonsDerivatives:"Sallitaanko teoksen muokkaaminen?",createCommonsDerivativesYes:"Kyllä",createCommonsDerivativesNo:"Ei",createCommonsDerivativesShareAlike:"Kyllä, mikäli muut jakavat samoin ehdoin",createCommonsCommercial:"Sallitaanko teoksen kaupallinen käyttö?",createCommonsCommercialYes:"Kyllä",createCommonsCommercialNo:"Ei",cc0Label:"CC0 1.0 Yleismaailmallinen",noneLabel:"Ei lisenssiä"}}},_create:function(){this._name=this.element.attr("id")||(this.element.attr("name")||"anon")+ ++d,this.element.hide(),this._widget=$("<div>").insertBefore(this.element);$("<select>").addClass("type").appendTo(this._widget);$.each(this.options.types,$.proxy(function(a,b){this._supportsType(a)&&this._addType(a,b)},this)),this.val(this.element.val(),"none"),this._widget.on("change","select.type",$.proxy(this._onTypeSelectChange,this)),this._widget.on("change",".creative-commons-attribute",$.proxy(this._onCreativeCommonsAttributeChange,this))},val:function(a,b){if(void 0===a)return this.element.val();this.element.val(a),this.element.hide();var c=this._resolveType(a,b||this._widget.find("select.type").val());this._widget.find(".type-options").hide(),this._widget.find('.type-options[data-type-id="'+c+'"]').show(),this._widget.find("select.type").val(c);var d=this._getPlaceholder(c);switch(d?this.element.attr("placeholder",d):this.element.removeAttr("placeholder"),this._resolveStrategy(c)){case"cc":$(this._widget).find('.type-options[data-type-id="'+c+'"] *[data-default="true"]').prop("checked","checked");var e=this._parseCreativeCommons(a);e&&$.each(e.attributes,$.proxy(function(a,b){$(this._widget).find('.type-options[data-type-id="'+c+'"] *[data-attribute="'+b+'"]').prop("checked","checked")},this));break;case"url":this.element.attr("type","url"),this.element.show();break;case"text":this.element.attr("type","text"),this.element.show()}},_onTypeSelectChange:function(a,b){var c=$(a.target).closest("select.type").val(),d=this._getTypeOptions(c);this.val(d.defaultValue)},_onCreativeCommonsAttributeChange:function(a,b){var c=$(a.target),d=this._parseCreativeCommons(this.val()),e=c.attr("data-attribute"),f=c.attr("data-remove-attributes");e&&-1==d.attributes.indexOf(e)&&d.attributes.push(e),f&&$.each(f.split(","),function(a,b){var c=d.attributes.indexOf(b);-1!=c&&d.attributes.splice(c,1)}),this.val(this._createCreativeCommonsUrl(d))},_getText:function(a){if(this.options.locale){var b=this.options.locales[this.options.locale][a];if(b)return b}return this.options.locales.en[a]},_getTypeOptions:function(a){return this.options.types[a]},_supportsType:function(a){return this._getTypeOptions(a)},_addType:function(a,b){switch(this._widget.find("select.type").append($("<option>").val(a).attr({name:"type"}).text(this._getText(b.labelLocale))),b.strategy){case"cc":$("<div>").attr({"data-type-id":a}).addClass("type-options creative-commons-container").append($("<label>").text(this._getText("createCommonsDerivatives"))).append(this._createCreativeCommonsList("creative-commons-derivatives",{yes:{label:this._getText("createCommonsDerivativesYes"),"remove-attributes":"sa,nd","default":!0},no:{label:this._getText("createCommonsDerivativesNo"),attribute:"nd","remove-attributes":"sa"},share_alike:{label:this._getText("createCommonsDerivativesShareAlike"),attribute:"sa","remove-attributes":"nd"}})).append($("<label>").text(this._getText("createCommonsCommercial"))).append(this._createCreativeCommonsList("creative-commons-commercial",{yes:{label:this._getText("createCommonsCommercialYes"),"remove-attributes":"nc","default":!0},no:{label:this._getText("createCommonsCommercialNo"),attribute:"nc"}})).hide().appendTo(this._widget);break;case"ogl":case"cc0":case"url":case"none":}},_createCreativeCommonsList:function(a,b){var c=$("<div>");return $.each(b,$.proxy(function(b,d){var e=this._name+"-"+a+"-"+b;$("<span>").append($("<input>").attr({type:"radio",name:this._name+"-"+a,value:b,id:e,"data-attribute":d.attribute,"data-remove-attributes":d["remove-attributes"],"data-default":d["default"]})).addClass("creative-commons-attribute").append($("<label>").attr({"for":e}).text(d.label)).appendTo(c)},this)),c},_getPlaceholder:function(a){if(a){var b=this._getTypeOptions(a);if(b&&b.placeholderLocale)return this._getText(b.placeholderLocale)}return null},_resolveStrategy:function(a){if(a){var b=this._getTypeOptions(a);if(b)return b.strategy}return"url"},_resolveType:function(a,d){if(a){if(this._supportsType("cc0-1.0")&&a==b)return"cc0-1.0";if(this._supportsType("ogl")&&a==c)return"ogl";if(this._supportsType("cc-4.0")||this._supportsType("cc-3.0")){var e=this._parseCreativeCommons(a);if(!e)return a.startsWith("//")||a.startsWith("http://")||a.startsWith("https://")?"link":"text";if("3.0"==e.version){if(this._supportsType("cc-3.0"))return"cc-3.0"}else if(this._supportsType("cc-4.0"))return"cc-4.0"}}return d||"none"},_parseCreativeCommons:function(b){var c=b.replace(/^[a-z]*:\/\//,"");if(0===c.indexOf(a)){var d=c.substring(a.length).split("/");if(1==d.length)return StringUtils.equals(d[0],"publicdomain")?{attributes:["publicdomain"]}:{attributes:d[0].split("-")};if(2==d.length)return{attributes:d[0].split("-"),version:d[1]};if(3==d.length)return{attributes:d[0].split("-"),version:d[1],jurisdiction:d[2]}}return null},_renderAttributes:function(a){var b=[];return-1!==a.indexOf("by")&&b.push("by"),-1!==a.indexOf("sa")&&b.push("sa"),-1!==a.indexOf("nc")&&b.push("nc"),-1!==a.indexOf("nd")&&b.push("nd"),b.join("-")},_createCreativeCommonsUrl:function(b){return"https://"+a+this._renderAttributes(b.attributes)+"/"+(b.version?b.version:"")+(b.jurisdiction?b.jurisdiction:"")},_destroy:function(){}})}).call(this);